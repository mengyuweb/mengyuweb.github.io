import{l as Re,E as ke,R as Oe,O as Ie,B as Te,a as Fe,m as Ve,g as He,b as oe,r as $,c as We,d as ze,e as Ne}from"./postprocessing.esm-da16e687.js";import{g as ae,a as ne,r as Ue}from"./currency-1843da70.js";import{O as se,S as $e,P as Ye,A as qe,D as Xe,a as Je,W as Ke,T as Qe,R as Ze,b as et,M as E,c as tt,d as B,e as ot,B as re,V as ce,L as ie,f as le,g as at,E as nt,h as st,i as rt}from"./three.module-96598850.js";import{O as ct}from"./OrbitControls-104f536d.js";import{m as it}from"./modifyCityMaterial-dcc2fbbe.js";import{g as de}from"./index-9e2476f3.js";import{G as lt}from"./dat.gui.module-798d8523.js";import{u as me}from"./index-c359eb9c.js";import{_ as dt}from"./breadcrumb.vue_vue_type_script_setup_true_lang-a8f45c07.js";import{d as pe,k as Y,l as mt,L as pt,o as ue,b as ut,i as G,g as ft,F as gt,M as ht,a as wt,y as xt}from"./index-5de0d8c7.js";import{_ as yt}from"./_plugin-vue_export-helper-c27b6911.js";import"./CSS2DRenderer-bca6bf67.js";const _t={class:"map_boxs"},bt={class:"breadcrumbs"},vt=pe({__name:"maps",setup(fe){const _=me(),{codeObj:b}=Ne,h=Y(null),L=Y(null);let R=Re();const k=new lt,O=_.mapAdcodeUserData,I=O.adcode,T=I?String(I):"100000";(async(e="_full")=>{const{features:t}=await He(T+e),c=I?O:b[T];e?Ce(t,c):_e(t,c)})(),mt(()=>{Se(h.value,L.value)});const q=ae(),X=ne();let v,J;const i={depth:5,rotationx:-.5*Math.PI,lineColor:"#d3be6c",panelColor:"#2a3547",panelActiveColor:"#f59e0b",panelBottomColor:"#77818f",visibleEdgeColor:"#f6ec22"},C=new se,n=new $e,d=new Ye(45,q/X,.01,1e3);d.position.set(0,85,120),d.aspect=ae()/ne(),d.updateProjectionMatrix(),n.add(d);const ge=new qe(5);n.add(ge);const he=new Xe(16777215,1.5);n.add(he);const we=new Je(16777215,1.5);n.add(we);const u=new Ke({alpha:!0}),P=u.domElement;u.setSize(q,X);const F=new ct(d,R.domElement);F.enableDamping=!0,F.maxPolarAngle=1.2;const D=new ke(u);D.addPass(new Oe(n,d));const M=new Ie(n,d,{blendFunction:Te.SCREEN,edgeStrength:2,pulseSpeed:0,visibleEdgeColor:16777215,hiddenEdgeColor:7208959,height:480,blur:!0,xRay:!1}),K=new Fe(d,M);D.addPass(K);const Q=()=>{F.update(),J=requestAnimationFrame(Q),u.render(n,d),D.render(),R.render(n,d)};Q();const Z=new Qe,xe=Z.load("/src/assets/img/texture/biaomian.png"),ye=T=="100000"?"cj.png":"map_bj.jpg",p=Z.load("/src/assets/img/texture/"+ye);p.wrapS=p.wrapT=Ze,p.repeat.set(.001,.001),p.offset.set(.25,.62),k.add(p.offset,"x").name("图片x轴").min(0).max(1).step(.01),k.add(p.offset,"y").name("图片y轴").min(0).max(1).step(.01);const ee=e=>e=="province"?1e3:e=="city"?2500:260,_e=(e,{centroid:t,level:c})=>{w||(w=oe().center(t).scale(ee(c)).translate([0,0]));const s=new se;e.forEach(a=>{let r=a.geometry.coordinates[0];r=r.length>1?[[...r]]:r,r.forEach(o=>{const l=new re,f=new Array;for(let g=0;g<o.length;g++){let[W,z]=w(o[g]);f.push(new ce(W,-z,i.depth+.3))}l.setFromPoints(f);const x=new ie({color:i.lineColor});let A=new le(l,x);s.add(A),M.selection.add(A)})}),s.rotation.x=i.rotationx,n.add(s)},be=new et(1e3,1e3),ve=new E({map:xe,side:tt}),V=new B(be,ve);V.rotation.x=i.rotationx,V.position.set(0,-5,0),n.add(V);let w,H={};const Ce=(e,{centroid:t,level:c})=>{w=oe().center(t).scale(ee(c)).translate([0,0]),e.forEach((s,a)=>{let r=s.geometry.coordinates[0];if(a==0||a==5){const o=w(s.properties.centroid);Pe(o,s.properties)}r=r.length>1?[[...r]]:r,r.forEach(o=>{const l=new at,f=new re,x=new Array;for(let S=0;S<o.length;S++){let[N,U]=w(o[S]);x.push(new ce(N,-U,i.depth)),S===0&&l.moveTo(N,-U),l.lineTo(N,-U)}f.setFromPoints(x);const A=new ie({color:$()});let g=new le(f,A);g.rotation.x=i.rotationx,g.position.set(0,.5,0),n.add(g);const W={depth:i.depth,bevelEnabled:!0},z=new nt(l,W),Ge=new E({map:p}),Le=new E({color:i.panelBottomColor}),y=new B(z,[Ge,Le]);y.userData=s.properties,y.userData.color=i.panelColor,y.userData.activeColor=i.panelActiveColor,y.name=s.properties.name,it(y,1),C.add(y)})}),C.rotation.x=i.rotationx,n.add(C)},Pe=(e,t,c="")=>{const[s,a,r]=[...e,i.depth*2];Ee([s,a],t);const o=Ue(10,20);t.value=o,t.positiony=i.depth;const l=We({x:s,y:a,height:o});ze(l,t),n.add(l),H[t.adcode]=t},Ee=(e,t,c)=>{const[s,a,r]=[...e,i.depth+.6];t.adcode=="100000"?Me([s,a,r]):De([s,a,r])},De=([e,t,c],s)=>{const a=new st(1,1.1,20),r=new E({color:$()}),o=new B(a,r);o.position.set(e,c,t),o.rotation.x=i.rotationx;const l=3;n.add(o),M.selection.add(o),de.to(o.scale,{x:l,y:l,z:l,repeat:-1,duration:5,ease:"power1.imOut"})},Me=([e,t,c],s)=>{const a=new rt(1,.2,10,100,6),r=new E({color:$(),map:p}),o=new B(a,r);o.position.set(e,c,t),o.rotation.x=i.rotationx,n.add(o),M.selection.add(o),de.to(o.rotation,{z:10,repeat:-1,duration:10,ease:"power1.inOut",yoyo:!0})};window.addEventListener("click",te),document.addEventListener("mousemove",te);let m=null,j=null;function te(e){e.stopPropagation();let t=je(e);const c=new ot;c.setFromCamera(t,d);const s=c.intersectObjects([C],!0);if(s.length>0){const a=s[0].object;if(e.type=="click"){const{acroutesObj:r,adcode:o,name:l,center:f,centroid:x}=O;l?_.setAdcode({...a.userData,acroutesObj:{...r,[o]:{adcode:o,name:l,center:f,centroid:x}}}):_.setAdcode({...a.userData,acroutesObj:{1e5:"中国"}});return}m&&m.object.name!==a.name&&(m.object.material[0].color.set(j),m=null),m=s[0],a.name&&(j||(j=m.object.material[0].color.clone()),Ve(v,e.clientX,e.clientY),a.material[0].color.set(a.userData.activeColor),H[a.userData.adcode]||(H[a.userData.adcode]=a.userData))}else m&&m.object.name&&(m.object.material[0].color.set(j),m=null),v&&v.childNodes.length&&(v.innerHTML="")}function je(e){e.stopPropagation();let t={x:0,y:0};const c=Ae(e);return t.x=c.x/P.width*2-1,t.y=c.y/P.height*-2+1,t}function Ae(e){e.stopPropagation();const t=P.getBoundingClientRect();return{x:(e.clientX-t.left)*P.width/t.width,y:(e.clientY-t.top)*P.height/t.height}}const Se=(e,t)=>{e&&(e.appendChild(u.domElement),e.appendChild(R.domElement),v=t)},Be=()=>{if(n){for(n.traverse(function(e){});n.children.length>0;)n.remove(n.children[0]);u.dispose(),n.remove(C),n.clear(),D.removePass(K),u.clearDepth(),cancelAnimationFrame(J),k.destroy()}};return pt(()=>Be()),(e,t)=>(ue(),ut(gt,null,[G("div",_t,[G("div",{ref_key:"mapId",ref:h,class:"map_box"},null,512),G("div",bt,[ft(dt)])]),G("div",{ref_key:"mood_Id",ref:L,class:"mood_box2"},null,512)],64))}});const Ct=yt(vt,[["__scopeId","data-v-dce13169"]]),It=pe({__name:"index",setup(fe){const _=me(),b=Y(!0);return _.$subscribe(h=>{if(console.log(h.events.newValue),h.events.newValue.level=="district"){alert("切换地图");return}b.value=!1,ht(()=>{b.value=!0})}),(h,L)=>b.value?(ue(),wt(Ct,{key:0})):xt("",!0)}});export{It as default};
