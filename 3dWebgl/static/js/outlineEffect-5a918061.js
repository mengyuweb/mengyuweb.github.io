import{S as ae,P as se,W as re,X as P,e as ie,O as ce,g as q,B as le,V as de,L as pe,f as me,E as Y,M as F,d as J}from"./three.module-96598850.js";import{O as ue}from"./OrbitControls-104f536d.js";import{l as fe,E as he,R as ge,O as we,i as ye,S as xe,B as Ee,a as ve,g as Ce,b as K,j as be,k as Pe,r as _e,c as Be,d as Me}from"./postprocessing.esm-da16e687.js";import{g as Se,a as Re,r as De}from"./currency-1843da70.js";import{s as N}from"./separate-c4e7db7a.js";import{g as ke}from"./index-9e2476f3.js";import{V as Ae}from"./VideoPlane-bbf6f73b.js";import{d as Oe,k as Ge,l as je,o as Le,b as Fe}from"./index-5de0d8c7.js";import"./CSS2DRenderer-bca6bf67.js";const Ke=Oe({__name:"outlineEffect",setup(We){const _=Ge(null),W=Se(),V=Re(),i=new ae,m=new se(45,W/V,.1,1e3);m.position.set(0,20,70);const h=new re({antialias:!0});h.setSize(W,V),h.setPixelRatio(window.devicePixelRatio);const a={depth:1,rotationx:-.5*Math.PI,positiony:-5,lineColor:"#d3be6c",panelColor:"#2a3547",panelActiveColor:"#f59e0b",panelBottomColor:"#77818f",visibleEdgeColor:"#f6ec22"};let B=fe();const M=new ue(m,B.domElement);M.enableDamping=!0,M.maxPolarAngle=1.2,je(()=>{var t;(t=_.value)==null||t.appendChild(h.domElement)});const S=new he(h);S.addPass(new ge(i,m));const z=new we(i,m,{edgeStrength:8,visibleEdgeColor:16096779,hiddenEdgeColor:16777215,blur:!0,xRay:!1}),Q=new ye;new xe(i,m,{mipmapBlur:!0,blendFunction:Ee.ADD,intensity:8});const U=new ve(m,z,Q);S.addPass(U);const E=new P,I=new P,R=new P,g=new P;let f;const Z=(t,{centroid:e=[108.93,34.37],level:r=""})=>{f=K().center(e).scale(N(r)).translate([0,0]);const s=new ce;t.forEach((o,u)=>{let p=o.geometry.coordinates[0];if(u==1||u==5){const n=f(o.properties.centroid);o.properties.index=u,ee(n,o.properties)}else if(u==3){const n=f(o.properties.centroid),l=2;be().then(d=>{d.position.set(n[0],a.depth+1.3,n[1]),d.scale.set(l,l,l),ke.to(d.position,{y:6,repeat:-1,duration:1,ease:"power1.imOut",yoyo:!0}),i.add(d),i.add(Pe({x:n[0],y:n[1]}))})}p=p.length>1?[[...p]]:p,p.forEach(n=>{const l=new q,d=new le,C=new Array;for(let b=0;b<n.length;b++){let[j,L]=f(n[b]);C.push(new de(j,-L,a.depth+.4)),b===0&&l.moveTo(j,-L),l.lineTo(j,-L)}d.setFromPoints(C);const D=new pe({color:_e()});let k=new me(d,D);s.add(k);const A={depth:a.depth,bevelEnabled:!0,bevelSegments:1},y=new Y(l,A),O=new F({color:a.panelColor}),G=new F({color:a.panelBottomColor}),x=new J(y,[O,G]);x.userData=o.properties,x.userData.color=a.panelColor,x.userData.activeColor=a.panelActiveColor,x.name=o.properties.name,E.add(x)})}),s.rotation.x=a.rotationx,E.rotation.x=a.rotationx,I.add(s),i.add(I),i.add(E)},$=(t,{centroid:e=[108.93,34.37],level:r=""})=>{f=K().center(e).scale(N(r)).translate([0,0]),t.forEach((u,p)=>{let n=u.geometry.coordinates[0];n=n.length>1?[[...n]]:n,n.forEach(l=>{const d=new q;for(let y=0;y<l.length;y++){let[O,G]=f(l[y]);d.lineTo(O,-G)}const C={depth:.001},D=new Y(d,C),k=new F({transparent:!0,opacity:0}),A=new J(D,k);g.add(A)})}),g.rotation.x=a.rotationx,g.position.y=a.depth+.4,z.selection.set([g.children[0]]),i.add(g),i.add(R),_.value.appendChild(B.domElement);const s=150;let o=new Ae("./video/zp2.mp4",{x:s,y:s/2+10});o.mesh.rotation.x=a.rotationx,i.add(o.mesh)},T=async(t={adcode:1e5},e="_full")=>{const{adcode:r}=t,{features:s}=await Ce(r+e);e?Z(s,t):$(s,t)};T({adcode:1e5},""),T();const ee=(t,e,r="")=>{const[s,o,u]=[...t,a.depth*2],p=De(4,10);e.value=p,e.positiony=a.depth;const n=Be({x:s,y:o,height:p});Me(n,e),R.add(n),te[e.adcode]=e};let c=null,v=null,te={};document.addEventListener("mousemove",H),window.addEventListener("click",H);function H(t){t.stopPropagation();const e=oe(t),r=new ie;r.setFromCamera(e,m);const s=r.intersectObjects([E,R],!0);if(s.length>0){const o=s[0].object;if(o.name=="active"){console.log(o);return}if(c)if(c.name!==o.name)c.material[0].color.set(v),c=null;else return;c=o,o.name&&(v||(v=c.material[0].color.clone()),o.material[0].color.set(o.userData.activeColor),console.log(o.name))}else c&&c.name&&(c.material[0].color.set(v),c=null)}const w=h.domElement;function oe(t){t.stopPropagation();let e={x:0,y:0};const r=ne(t);return e.x=r.x/w.width*2-1,e.y=r.y/w.height*-2+1,e}function ne(t){t.stopPropagation();const e=w.getBoundingClientRect();return{x:(t.clientX-e.left)*w.width/e.width,y:(t.clientY-e.top)*w.height/e.height}}function X(){requestAnimationFrame(X),M.update(),S.render(),B.render(i,m)}return X(),(t,e)=>(Le(),Fe("div",{ref_key:"mapId",ref:_,class:"map_box"},null,512))}});export{Ke as default};
