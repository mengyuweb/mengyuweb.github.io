import{V as rt,S as Rt,P as kt,W as At,X as A,e as Bt,O as Dt,g as ht,B as jt,L as Ft,f as zt,E as ut,M as G,d as X,h as Ut,i as Gt}from"./three.module-96598850.js";import{O as Lt}from"./OrbitControls-104f536d.js";import{l as Nt,E as qt,R as Wt,O as Ht,i as Qt,S as Yt,B as Xt,a as $t,g as Jt,b as ft,r as it,c as Kt,d as Zt}from"./postprocessing.esm-da16e687.js";import{g as Vt,a as te,r as ee}from"./currency-1843da70.js";import{c as ie,s as dt}from"./separate-c4e7db7a.js";import{g as $}from"./index-9e2476f3.js";import{m as ne}from"./modifyCityMaterial-dcc2fbbe.js";import{V as re}from"./VideoPlane-bbf6f73b.js";import{d as se,k as pt,l as oe,o as ae,b as ce}from"./index-5de0d8c7.js";import"./CSS2DRenderer-bca6bf67.js";var D=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return this.None(t)},Out:function(t){return this.None(t)},InOut:function(t){return this.None(t)}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return .5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function(t){return t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function(t){return t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(t){var e=1.70158;return t===1?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return t===0?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-D.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?D.Bounce.In(t*2)*.5:D.Bounce.Out(t*2-1)*.5+.5}}),generatePow:function(t){return t===void 0&&(t=4),t=t<Number.EPSILON?Number.EPSILON:t,t=t>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(e*2,t)/2:(1-Math.pow(2-e*2,t))/2+.5}}}}),B=function(){return performance.now()},vt=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},t.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},t.prototype.update=function(e,i){e===void 0&&(e=B()),i===void 0&&(i=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var s=this._tweens[r[n]],o=!i;s&&s.update(e,o)===!1&&!i&&delete this._tweens[r[n]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),I={Linear:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),s=I.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[i],t[i-1],i-r):s(t[n],t[n+1>i?i:n+1],r-n)},Bezier:function(t,e){for(var i=0,r=t.length-1,n=Math.pow,s=I.Utils.Bernstein,o=0;o<=r;o++)i+=n(1-e,r-o)*n(e,o)*t[o]*s(r,o);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),s=I.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(r=i*(1+e))),s(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],r-n)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):s(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],r-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=I.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var r=e;r>1;r--)i*=r;return t[e]=i,i}}(),CatmullRom:function(t,e,i,r,n){var s=(i-t)*.5,o=(r-e)*.5,a=n*n,p=n*a;return(2*e-2*i+s+o)*p+(-3*e+3*i-2*s-o)*a+s*n+e}}},st=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),nt=new vt,le=function(){function t(e,i){i===void 0&&(i=nt),this._object=e,this._group=i,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=D.Linear.None,this._interpolationFunction=I.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=st.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(e,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i,this},t.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e,this},t.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},t.prototype.start=function(e,i){if(e===void 0&&(e=B()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var s in this._valuesEnd)n[s]=this._valuesEnd[s];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},t.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},t.prototype._setupProperties=function(e,i,r,n,s){for(var o in r){var a=e[o],p=Array.isArray(a),S=p?"array":typeof a,w=!p&&Array.isArray(r[o]);if(!(S==="undefined"||S==="function")){if(w){var v=r[o];if(v.length===0)continue;for(var L=[a],j=0,x=v.length;j<x;j+=1){var F=this._handleRelativeValue(a,v[j]);if(isNaN(F)){w=!1,console.warn("Found invalid interpolation list. Skipping.");break}L.push(F)}w&&(r[o]=L)}if((S==="object"||p)&&a&&!w){i[o]=p?[]:{};var y=a;for(var E in y)i[o][E]=y[E];n[o]=p?[]:{};var v=r[o];if(!this._isDynamic){var P={};for(var E in v)P[E]=v[E];r[o]=v=P}this._setupProperties(y,i[o],v,n[o],s)}else(typeof i[o]>"u"||s)&&(i[o]=a),p||(i[o]*=1),w?n[o]=r[o].slice().reverse():n[o]=i[o]||0}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(e){return e===void 0&&(e=B()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},t.prototype.resume=function(e){return e===void 0&&(e=B()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},t.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},t.prototype.group=function(e){return e===void 0&&(e=nt),this._group=e,this},t.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},t.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},t.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},t.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},t.prototype.easing=function(e){return e===void 0&&(e=D.Linear.None),this._easingFunction=e,this},t.prototype.interpolation=function(e){return e===void 0&&(e=I.Linear),this._interpolationFunction=e,this},t.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},t.prototype.onStart=function(e){return this._onStartCallback=e,this},t.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},t.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},t.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},t.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},t.prototype.onStop=function(e){return this._onStopCallback=e,this},t.prototype.update=function(e,i){if(e===void 0&&(e=B()),i===void 0&&(i=!0),this._isPaused)return!0;var r,n,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>s)return!1;i&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=this._duration===0||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),n===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(r in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]=="string"&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,p=this._chainedTweens.length;a<p;a++)this._chainedTweens[a].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(e,i,r,n){for(var s in r)if(i[s]!==void 0){var o=i[s]||0,a=r[s],p=Array.isArray(e[s]),S=Array.isArray(a),w=!p&&S;w?e[s]=this._interpolationFunction(a,n):typeof a=="object"&&a?this._updateProperties(e[s],o,a,n):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*n))}},t.prototype._handleRelativeValue=function(e,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?e+parseFloat(i):parseFloat(i)},t.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},t}(),he="20.0.3",ue=st.nextId,C=nt,fe=C.getAll.bind(C),de=C.removeAll.bind(C),pe=C.add.bind(C),_e=C.remove.bind(C),ve=C.update.bind(C),gt={Easing:D,Group:vt,Interpolation:I,now:B,Sequence:st,nextId:ue,Tween:le,VERSION:he,getAll:fe,removeAll:de,add:pe,remove:_e,update:ve};const _t=t=>{if(t.isMesh){var e=t;e.geometry.computeBoundingBox();var i=new rt;return i.addVectors(e.geometry.boundingBox.min,e.geometry.boundingBox.max),i.multiplyScalar(.5),i.applyMatrix4(e.matrixWorld),i}},ge=t=>{const{object1:e,camera:i,controls:r}=t,n=_t(e),s=i.getWorldDirection(new rt),o=n.clone().sub(s.multiplyScalar(40));console.log(_t(e)),new gt.Tween(i.position).to(o,1e3).onComplete(function(){r.target=n,r.update()}).start()},Oe=se({__name:"cameraAnimation",setup(t){const e=pt(null),i=Vt(),r=te(),n=new Rt,s=new kt(45,i/r,.1,1e3);s.position.set(0,20,70);const o=new At({antialias:!0});o.setSize(i,r),o.setPixelRatio(window.devicePixelRatio);const a={depth:1,rotationx:-.5*Math.PI,positiony:-5,lineColor:"#d3be6c",panelColor:"#2a3547",panelActiveColor:"#f59e0b",panelBottomColor:"#77818f",visibleEdgeColor:"#f6ec22"};let p=Nt();const S=new Lt(s,p.domElement);ie(S),oe(()=>{var c;(c=e.value)==null||c.appendChild(o.domElement)});const w=new qt(o);w.addPass(new Wt(n,s));const v=new Ht(n,s,{edgeStrength:8,visibleEdgeColor:16096779,hiddenEdgeColor:16777215,blur:!0,xRay:!1}),L=new Qt;new Yt(n,s,{mipmapBlur:!0,blendFunction:Xt.ADD,intensity:8});const j=new $t(s,v,L);w.addPass(j);const x=new A,F=new A,y=new A,E=new A,P=new A;let T,J;const yt=(c,{centroid:l=[108.93,34.37],level:d=""})=>{T=ft().center(l).scale(dt(d)).translate([0,0]);const u=new Dt;c.forEach((h,_)=>{const{centroid:f,center:g,name:m,adcode:W}=h.properties;if(W==71e4||!m)return;let M=h.geometry.coordinates[0];const H=f||g;if(f||(h.properties.centroid=g),_==1||_==5){const R=T(H);h.properties.index=_,at(R,h.properties)}M=M.length>1?[[...M]]:M,M.forEach(R=>{const U=new ht,Q=new jt,k=new Array;for(let Y=0;Y<R.length;Y++){let[tt,et]=T(R[Y]);k.push(new rt(tt,-et,a.depth+.4)),Y===0&&U.moveTo(tt,-et),U.lineTo(tt,-et)}Q.setFromPoints(k);const Z=new Ft({color:it()});let V=new zt(Q,Z);u.add(V);const xt={depth:a.depth,bevelEnabled:!0,bevelSegments:1},Ot=new ut(U,xt),It=new G({color:a.panelColor}),Tt=new G({color:a.panelBottomColor}),O=new X(Ot,[It,Tt]);O.userData=h.properties,O.userData.color=a.panelColor,O.userData.activeColor=a.panelActiveColor,O.name=m,O.userData.centroid2=H,x.add(O),ne(O,1)})}),u.rotation.x=a.rotationx,x.rotation.x=a.rotationx,F.add(u),ot({adcode:1e5},"")},wt=(c,{centroid:l=[108.93,34.37],level:d=""})=>{T=ft().center(l).scale(dt(d)).translate([0,0]),c.forEach((f,g)=>{let m=f.geometry.coordinates[0];m=m.length>1?[[...m]]:m,m.forEach(W=>{const M=new ht;for(let k=0;k<W.length;k++){let[Z,V]=T(W[k]);M.lineTo(Z,-V)}const H={depth:.001},R=new ut(M,H),U=new G({transparent:!0,opacity:0}),Q=new X(R,U);P.add(Q)})}),P.rotation.x=a.rotationx,P.position.y=a.depth+.4,v.selection.set([P.children[0]]);const u=new A;u.add(x),u.add(F),n.add(u);const h=.1;u.scale.set(h,h,h);const _=1;$.to(u.scale,{x:_,y:_,z:_,duration:2,ease:"back.out(3)",onComplete:()=>{console.log("动画放大完成"),n.add(P),n.add(E),n.add(y),e.value.appendChild(p.domElement),K();const f=150;let g=new re("./video/zp2.mp4",{x:f,y:f/2+10});g.mesh.rotation.x=a.rotationx,n.add(g.mesh)}})},ot=async(c={adcode:1e5},l="_full")=>{const{adcode:d}=c,{features:u}=await Jt(d+l);l?yt(u,c):wt(u,c)};ot();const at=(c,l,d="")=>{const[u,h,_]=[...c,a.depth*2];bt([u,h],l);const f=ee(4,10);l.value=f,l.positiony=a.depth;const g=Kt({x:u,y:h,height:f});Zt(g,l),y.add(g),y.position.y=-f,console.log(y.position.y),$.to(y.position,{y:0,duration:2,ease:"power1.imOut"}),Et[l.adcode]=l},bt=(c,l,d)=>{const[u,h,_]=[...c,a.depth+.6];l.adcode=="100000"?Pt([u,h,_]):Ct([u,h,_])},Ct=([c,l,d],u)=>{const h=new Ut(1,1.1,20),_=new G({color:it()}),f=new X(h,_);f.position.set(c,d,l),f.rotation.x=a.rotationx;const g=2;y.add(f),$.to(f.scale,{x:g,y:g,z:g,duration:2,ease:"power1.imOut",yoyo:!0,delay:2,repeat:-1})},Pt=([c,l,d],u)=>{const h=new Gt(1,.2,10,100,6),_=new G({color:it()}),f=new X(h,_);f.position.set(c,d,l),f.rotation.x=a.rotationx,v.selection.add(f),y.add(f),$.to(f.rotation,{z:10,repeat:-1,duration:10,ease:"power1.inOut",yoyo:!0})},N=pt(0),K=()=>{const c=x.children;N.value>c.length&&(N.value=0),J=setTimeout(()=>{clearTimeout(J);const l=c[N.value];console.log(l),St(l),N.value++,K()},6e3)},St=c=>{const{centroid2:l}=c.userData;y.children=[];const d=document.getElementById("labelBoxs");d.innerHTML="",at(T(l),c.userData),ge({object1:c,camera:s,controls:S})};let b=null,q=null,Et={};document.addEventListener("mousemove",ct),window.addEventListener("click",ct);function ct(c){c.stopPropagation();const l=mt(c),d=new Bt;d.setFromCamera(l,s);const u=d.intersectObjects([x,E],!0);if(u.length>0){clearTimeout(J);const h=u[0].object;if(h.name=="active"){v.selection.set([P.children[0],h]);return}if(b)if(b.name!==h.name)b.material[0].color.set(q),b=null;else return;b=h,h.name&&(q||(q=b.material[0].color.clone()),h.material[0].color.set(h.userData.activeColor),console.log(h.name))}else b&&(K(),b.name&&(b.material[0].color.set(q),b=null))}const z=o.domElement;function mt(c){c.stopPropagation();let l={x:0,y:0};const d=Mt(c);return l.x=d.x/z.width*2-1,l.y=d.y/z.height*-2+1,l}function Mt(c){c.stopPropagation();const l=z.getBoundingClientRect();return{x:(c.clientX-l.left)*z.width/l.width,y:(c.clientY-l.top)*z.height/l.height}}function lt(){w.render(),p.render(n,s),gt.update(),requestAnimationFrame(lt)}return lt(),(c,l)=>(ae(),ce("div",{ref_key:"mapId",ref:e,class:"map_box"},null,512))}});export{Oe as default};
